CREATE TABLE IF NOT EXISTS USERS
(
    ID    BIGINT                 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    EMAIL CHARACTER VARYING(255) NOT NULL,
    NAME  CHARACTER VARYING(255),
    PRIMARY KEY (ID),
    UNIQUE (EMAIL)
);
CREATE UNIQUE INDEX IF NOT EXISTS USERS_ID_IDX ON USERS (ID);
CREATE UNIQUE INDEX IF NOT EXISTS USERS_EMAIL_IDX ON USERS (EMAIL);

CREATE TABLE IF NOT EXISTS REQUESTS
(
    ID           BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    CREATED_DATE      TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    DESCRIPTION  CHARACTER VARYING(255),
    REQUESTER_ID BIGINT NOT NULL,
    PRIMARY KEY (ID),
    CONSTRAINT REQUESTS_FK_REQUESTER_ID_USER_ID FOREIGN KEY (REQUESTER_ID) REFERENCES USERS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT
);

CREATE TABLE IF NOT EXISTS ITEMS
(
    ID           BIGINT                 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    DESCRIPTION  CHARACTER VARYING(255) NOT NULL,
    IS_AVAILABLE BOOLEAN                NOT NULL,
    NAME         CHARACTER VARYING(255) NOT NULL,
    REQUEST_ID   BIGINT NULL,
    OWNER_ID     BIGINT NOT NULL,
    PRIMARY KEY (ID),
    CONSTRAINT ITEMS_OWNER_ID_USERS_ID FOREIGN KEY (OWNER_ID) REFERENCES USERS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT,
    CONSTRAINT ITEMS_REQUEST_ID_REQUESTS_ID FOREIGN KEY (REQUEST_ID) REFERENCES REQUESTS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT
);

CREATE INDEX IF NOT EXISTS ITEMS_REQUEST_ID_IDX ON ITEMS (REQUEST_ID);
CREATE INDEX IF NOT EXISTS ITEMS_ID_OWNER_ID_IDX ON ITEMS (ID, OWNER_ID);
CREATE INDEX IF NOT EXISTS ITEMS_OWNER_ID_IDX ON ITEMS (OWNER_ID);

CREATE TABLE IF NOT EXISTS BOOKINGS
(
    ID         BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    END_DATE   TIMESTAMP WITHOUT TIME ZONE,
    START_DATE TIMESTAMP WITHOUT TIME ZONE,
    STATUS     CHARACTER VARYING(8),
    BOOKER_ID  BIGINT,
    ITEM_ID    BIGINT,
    PRIMARY KEY (ID),
    CONSTRAINT BOOKINGS_ITEM_ID_ITEMS_ID FOREIGN KEY (ITEM_ID) REFERENCES ITEMS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT,
    CONSTRAINT BOOKINGS_BOOKER_ID_USERS_ID FOREIGN KEY (BOOKER_ID) REFERENCES USERS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT
);

CREATE INDEX IF NOT EXISTS BOOKINGS_ITEM_ID_IDX ON BOOKINGS (ITEM_ID);
CREATE INDEX IF NOT EXISTS BOOKINGS_BOOKER_ID_IDX ON BOOKINGS (BOOKER_ID);

CREATE TABLE IF NOT EXISTS COMMENTS
(
    ID        BIGINT                                             NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    CREATED   TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    TEXT      CHARACTER VARYING(255)                             NOT NULL,
    AUTHOR_ID BIGINT,
    ITEM_ID   BIGINT,
    PRIMARY KEY (ID),
    CONSTRAINT COMMENTS_FK_ITEM_ID_ITEMS_ID FOREIGN KEY (ITEM_ID) REFERENCES ITEMS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT,
    CONSTRAINT COMMENTS_FK_AUTHOR_ID_USERS_ID FOREIGN KEY (AUTHOR_ID) REFERENCES USERS (ID) ON
        DELETE
        RESTRICT ON
        UPDATE
        RESTRICT
);

CREATE INDEX IF NOT EXISTS COMMENTS_AUTHOR_ID_IDX ON COMMENTS (AUTHOR_ID);
CREATE INDEX IF NOT EXISTS COMMENTS_ITEM_ID_IDX ON COMMENTS (ITEM_ID);